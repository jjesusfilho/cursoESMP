---
title: "Regressão logística"
format: revealjs
editor: visual
execute:
  echo: true
---

## Regressão linear

A **regressão linear** é usada para aproximar a relação entre uma variável resposta **contínua** e um conjunto de variáveis preditoras.

```{r}
library(tidyverse)

```

```{r}
set.seed(123)
x <- seq(0, 10, length.out = 100)

linear_data <- data.frame(
  x = x,
  y_linear = 2 + 0.5 * x + rnorm(100, 0, 1)
)
```

------------------------------------------------------------------------

```{r}
ggplot() +
  geom_point(data = linear_data, aes(x = x, y = y_linear), color = 'blue', alpha = 0.6) +
  geom_smooth(data = linear_data, aes(x = x, y = y_linear), method = 'lm', color = 'darkblue') +
  labs(title = 'Regressão Linear', 
       x = 'Variável Independente', 
       y = 'Variável Dependente') +
  theme_minimal()
```

## Variáveis categórias

Regressão linear funciona bem com variáveis contínuas. Mas no Direito, muitas vezes queremos prever algo binário, como:

- A ação foi julgada procedente ou improcedente?

- O réu foi condenado ou absolvido?

- Houve ou não reincidência?


## De contínuo para binário

Imagine que você quer prever se uma decisão judicial será procedente (1) ou improcedente (0) com base, por exemplo, na quantidade de droga apreendida.

Se usássemos uma regressão linear, teríamos algo assim:

$$ \hat{y} = \beta_0 + \beta_1 \cdot x $$
Só que a saída dessa equação pode ser qualquer número real: 2, -5, 1.3, 20... Mas isso não faz sentido quando queremos prever algo que só pode ser 0 ou 1!

## Sigmoid

A função sigmoid resolve esses problemas ao transformar qualquer número real (como o resultado de uma regressão linear) em uma probabilidade entre 0 e 1:

$$
\sigma(z) = \frac{1}{1 + e^{-z}}
$$

Onde:

$$
z = \beta_0 + \beta_1 \cdot x
$$
$$
\sigma(z) 
$$ 
Representa a **probabilidade** de o evento acontecer (por exemplo, uma decisão procedente).

## Sigmoid no R

```{r}

set.seed(123)
x <- seq(0, 10, length.out = 100)

logistic_function <- function(x, beta0, beta1) {
  1 / (1 + exp(-(beta0 + beta1 * x)))
}

logistic_data <- data.frame(
  x = x,
  y_logistic = logistic_function(x, -2, 0.5)
)
```

## Sigmoid no R

```{r}
ggplot(logistic_data, aes(x = x, y = y_logistic)) +
  geom_line(color = 'red') +
  labs(title = 'Regressão Logística', 
       x = 'Variável Independente', 
       y = 'Probabilidade') +
  theme_minimal()
```


## Diferenças

-   Regressão logística não possui resíduos nem R2

-   Resposta em probabilidade

-   A fórmula possui uma função de ligação log(p/(1-p)) = beta0 + beta1\*x, isolando o p, temos:


## Regressão logística

```{r}
x1 <- 1:20


y <- ifelse(x1 <= 9, 0, 1)
z <- ifelse(x1 <= 9, 'blue', "red")


df <- tibble(x1, y,z)

p1 <- df |> 
  ggplot(aes(x = x1, y = y, color = z))+
  geom_point() +
  labs(title = 'Regressão Logística', 
       x = 'Variável Independente', 
       y = 'Probabilidade') +
theme_minimal() +
  theme(legend.position = "none")

```

## Variáveis categóricas

```{r echo = FALSE}
p1
```


## Regressão logística

A tabela abaixo mostra 279 casos de pessoas condenadas em primeira instância por tráfico de drogas e que pediram desclassificação para porte em segunda instância. Vamos rodar uma regressão logística em que a variável predita é decisao e as preditoras são gramas, camara, droga e antecentes.

```{r}
drogas <- jsonlite::fromJSON("https://gist.githubusercontent.com/jjesusfilho/de00e737237fff76a171ed139998dd58/raw/1004d00cac207bd0410c3ed50b0d131bac4402fe/drogas.json") |> 
  dplyr::mutate(decisao = as.factor(decisao))
gt::gt(head(drogas))
```

## Rodando a regressão logística

```{r}
modelo <- glm(decisao ~ camara + droga + antecedentes + gramas, data = drogas, family = "binomial")

broom::tidy(modelo)
```

## Interpretando os Coeficientes (Estimate)

Os coeficientes representam o efeito de cada variável independente sobre a variável dependente na escala logit.

-   Um coeficiente positivo significa que o aumento dessa variável aumenta a chance do evento ocorrer (provido).

-   Um coeficiente negativo significa que o aumento dessa variável reduz a chance do evento ocorrer.

## Interpretando os Coeficientes (Estimate)

Note que nos resultados, uma categórica não aparece. Isso ocorre porque ela está no intercepto. Veja que a 16ª Câmara tem coeficiente positivo (2.81) e ele indica o valor da 16ª Câmara em relação ao valor da 11ª, como ele é positivo, a indicação é que casos na 16ª têm maior probabilidade de provimento do que na 11ª. Para saber o quanto, basta exponenciar o coeficente: $exp(2.81) = 16.6$, ou seja, a 16ª Câmara tem 16 vez mais chances de provimento do que a 11ª. Esse valor é também chamado de ods ratio ou razões de chance.

## Exercícios

Calcule as razões de chance para maconha e presença de antecedentes.
